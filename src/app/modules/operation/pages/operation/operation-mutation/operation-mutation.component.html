<ng-container *ngIf="!isLoading; else loading">
  <form
    [formGroup]="operationForm"
    (ngSubmit)="onSubmit()">
    <div class="p-8 bg-dark">
      <div class="flex justify-between">
        <app-close-button (closeEvent)="goToList()"></app-close-button>

        <div
          class="flex flex-row items-center space-x-5"
          *ngIf="!isMutationAdd; else addSingleBtn">
          <app-rounded-button
            text="Cancel"
            bgColor="bg-gray-400"
            (clickEvent)="goToDetails()">
          </app-rounded-button>

          <app-rounded-button
            [text]="buttonType"
            [bgColor]="buttonColor"
            type="submit">
          </app-rounded-button>
        </div>
      </div>
    </div>

    <div class="p-10">
      <p class="text-white font-semibold">{{formType}} OPERATION</p>
      <div class="flex flex-row items-center justify-between pt-5">
        <app-form-label text="Select symbol"></app-form-label>
        <select
          name="symbolSelect"
          class="rounded"
          formControlName="symbol">
          <ng-container *ngFor="let symbol of symbols$ | async">
            <option [value]="symbol.id_sym">{{symbol.name_sym}}</option>
          </ng-container>
        </select>
      </div>

      <div class="flex flex-row items-center justify-between pt-5">
        <app-form-label text="Select order type"></app-form-label>
        <select
          name="orderTypeSelect"
          class="rounded"
          formControlName="orderType">
          <option [value]="1">BUY</option>
          <option [value]="0">SELL</option>
        </select>
      </div>

      <div class="flex flex-row items-center justify-between pt-5">
        <app-form-label text="Select date open"></app-form-label>
        <input
          class="rounded"
          type="datetime-local"
          formControlName="dateOpen">
      </div>

      <div class="flex flex-row items-center justify-between pt-5">
        <app-form-label text="Select date close"></app-form-label>
        <input
          class="rounded"
          type="datetime-local"
          formControlName="dateClose">
      </div>

      <div class="flex flex-row items-center justify-between pt-5">
        <app-form-label text="Select timeframe"></app-form-label>
        <select
          name="timeframeSelect"
          class="rounded"
          formControlName="timeframe">
          <ng-container *ngFor="let timeframe of timeframes">
            <option [value]="timeframe">{{timeframe}}</option>
          </ng-container>
        </select>
      </div>

      <div class="flex flex-row items-center justify-between pt-5">
        <app-form-label text="Select status"></app-form-label>
        <select
          name="statusSelect"
          class="rounded"
          formControlName="status">
          <ng-container *ngFor="let status of statuses$ | async">
            <option [value]="status.id_st">{{status.name_st}}</option>
          </ng-container>
        </select>
      </div>

      <div class="flex flex-row items-center justify-between pt-5">
        <app-form-label text="Select account"></app-form-label>
        <select
          name="accountType"
          class="rounded"
          formControlName="account">
          <ng-container *ngFor="let account of accountTypes; index as i">
            <option [value]="i+1">{{account}}</option>
          </ng-container>
        </select>
      </div>

      <div class="flex flex-row items-center justify-between pt-5">
        <app-form-label text="Volume"></app-form-label>
        <input
          class="w-[100px] rounded"
          type="number"
          formControlName="volume">
      </div>

      <div class="flex flex-row items-center justify-between pt-5">
        <app-form-label text="Risk reward %"></app-form-label>
        <input
          class="w-[100px] rounded"
          type="number"
          formControlName="ratio">
      </div>

      <div class="flex flex-row items-center justify-between pt-5">
        <app-form-label text="Revenue"></app-form-label>
        <input
          class="w-[100px] rounded"
          type="number"
          formControlName="revenue">
      </div>

      <div class="flex items-center justify-between pt-5">
        <app-form-label text="Comment"></app-form-label>
        <textarea
          name="commentSelect"
          class="rounded"
          formControlName="comment"
          cols="30"
          rows="5"></textarea>
      </div>
      <div class="flex items-center flex-row justify-end pt-10">
        <button type="button">
          <label class="flex flex-row bg-red-violet rounded text-white items-center font-semibold p-3">
            <svg-icon
              [svgStyle]="{'height.px': 32, 'width.px': 32}"
              src="assets/svg/graphics.svg"></svg-icon>
            <div class="pl-2">
              <h5 class="text-center">Upload chart</h5>
            </div>
            <input
              class="hidden"
              type="file"
              name="chart"
              (change)="uploadFileMemory($event)">
          </label>
        </button>
        <div
          *ngIf="uploadedFile"
          class="flex flex-col">
          <div class="flex flex-row items-center pl-4 space-x-2">
            <p class="text-white">File uploaded</p>
            <app-text-button
              buttonText="Cancel"
              buttonClass="bg-red text-white rounded p-1"
              (clickEvent)="removeFileMemory()">
            </app-text-button>
          </div>
          <p class="text-green">{{uploadedFile.name}}</p>
        </div>
      </div>
    </div>
  </form>
</ng-container>

<ng-template #loading>
  <app-loading-template></app-loading-template>
</ng-template>

<ng-template #addSingleBtn>
  <app-rounded-button
    [text]="buttonType"
    [bgColor]="buttonColor"
    type="submit">
  </app-rounded-button>
</ng-template>
